var Admin = {
    setupWeekConceptTable : function() {
        $('#week-concept-table td').click(function() {
            var i = $(this).find('input[type=checkbox]');
            if(i.is(':checked')) {
                i.click();
            } else {
                i.click();
            }
        });

        $('#week-concept-table td input').click(function(event) {
            event.stopPropagation();
        });

        $('.switch-all').click(function() {
            var val = $(this).is(':checked');
            var week = $(this).data('week');
            $('input[data-week='+week+']').prop("checked",val);
        });
    },

    setupQuestionConceptConfig : function() {
        this.setupConceptDelete();
        $('.question-concept-table-cell').click(function() {
            $(this).toggleClass('show');
        });

        $('.concept-autocomplete').autocomplete({
            source: gon.concepts
        });

        $('.concept-add').click(function() {
            var input = $('.concept-autocomplete[data-question-id='+$(this).data('question-id')+']');
            Admin.addConcept(input);
        });

        $('.concept-autocomplete').keyup(function(e){
            if (e.keyCode==13) {
                Admin.addConcept($(this));
            }
        })

    },

    addConcept : function(input) {
        $.ajax({
            url: window.location+'/add_question_concept',
            method: 'POST',
            data: {
                question_id: input.data('question-id'),
                concept_name: input.val()
            }
        });
    },

    setupConceptDelete : function() {
        $('.concept-delete').click(function() {
            $.ajax({
                url: window.location+'/delete_question_concept',
                method: 'POST',
                data: {
                    question_id: $(this).data('question-id'),
                    concept_id: $(this).data('concept-id')
                }
            });
        });
    },

    // Sleduje input a caka na to, kym sa zmeni jeho hodnota. Akonahle sa zmeni, zobrazi sa povodna hodnota.
    checkAnwserAny: function(input, defaultValue) {

        var originalAnswer = $(input).next('.original-input-text');

        if ($(input).val() != defaultValue) {
            $(input).addClass('question-answer-with-original');
            originalAnswer.slideDown(200);
        }
        else {
            $(input).removeClass('question-answer-with-original');
            originalAnswer.slideUp(200);
        }

    },

    // Na pozadi nacita zoznam vsetkej spatnej vazby.
    fetchFeedback: function() {

        var url = '<%= Rails.application.routes.url_helpers.question_feedbacks_path('LO_ID') %>'.replace('LO_ID', Admin.currentLoId);
        var template = doT.template($('#feedback-widget-template').html().replace(/FEEDBACK_ID/g, '{{=it.id}}'));
        var list = $('#feedbacks-list');
        var listEmpty = $('#feedbacks-empty');
        var listUnresolved = $('#feedback-widget').find('.mini-list');
        var unresolved = 0;

        $.getJSON(url, {}, function(resp) {

          if (resp.length == 0) {
            list.hide();
            listEmpty.show();
          }
          else {
            list.show();
            listEmpty.hide();
          }

          list.html('');
          listUnresolved.html('');

          $.each(resp, function(i, feedback) {
            feedback.widget = false;
            list.append(template(feedback));
            feedback.widget = true;
            listUnresolved.append(template(feedback));
            if (feedback.accepted == null) { unresolved++; }
          });

          if (unresolved > 0) {
            $('#answer-settings-col').addClass('col-lg-8').removeClass('col-lg-12');
            $('#answer-feedback-col').fadeIn(100);
            $('#feedback-not-reviewed-count').html(' ('+resp.length+')');
          }
          else {
            $('#answer-feedback-col').fadeOut(100);
            $('#answer-settings-col').removeClass('col-lg-8').addClass('col-lg-12');
            $('#feedback-not-reviewed-count').html('');
          }

        });

    },

};