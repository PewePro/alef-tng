<nav>
  <div class="admin-nav">
    <h2><%= t('admin.concepts.labels.management') %></h2>
    <%= link_to((fa_icon('user-secret') + t('homescreen.links.admin')).html_safe,
                administration_path, class: 'admin-nav-button') %>
  </div>
</nav>
<hr class="nav-offset">

<div class="concept-buttons">
  <div class="admin">
    <button type="button" class="btn" onclick="changes.submit(this);">Uložiť všetky zmeny</button>
    <span id="concept-buttons-changes" style="display: none">Počet vykonaných zmien: <span id="concept-buttons-changes-count">0</span></span>
  </div>
</div>
<div class="concept-loading" style="display: none;">
  prebieha ukladanie zmien...
</div>

<div id="concepts-list" class="admin">
  <%= form_for Concept.new, url: admin_concepts_path(course: @course), method: :post do |f| %>
    <div class="concept-item concept-new-item">
      <div class="form-group">
        <%= f.text_field :name, class: 'concept_name', placeholder: 'zadajte názov konceptu...' %>
      </div>
      <div class="form-group">
        <%= f.check_box :pseudo, checked: false %>
        <%= f.label :pseudo %>
      </div>
      <div class="form-group">
        <%= f.submit 'Vytvoriť koncept', disable_with: t('global.texts.saving') %>
      </div>
    </div>
  <% end %>
  <% @concepts.each do |concept| %>
    <div class="concept-item" id="concept<%= concept.id %>" data-object-id="<%= concept.id %>">
      <div class="form-buttons">
        <button type="button" class="btn" onclick="concept_learning_objects(<%= concept.id %>, '<%= concept.name %>');return false"><i class="fa fa-link"></i> Otázky (<%= @concepts_counts.key?(concept.id) ? @concepts_counts[concept.id] : 0 %>)</button>
        <button type="button" class="btn" onclick="concept_delete(<%= concept.id %>, '<%= admin_concept_path(concept, method: :delete).html_safe %>');return false"><i class="fa fa-trash"></i></button>
      </div>
      <div class="form-group">
        <%= text_field_tag "concept_name#{concept.id}", concept.name, class: 'concept_name', data: { attr: :name } %>
      </div>
      <div class="form-group">
        <%= check_box_tag "concept_pseudo#{concept.id}", 1, concept.pseudo, data: { attr: :pseudo } %>
        <%= label_tag "concept_pseudo#{concept.id}", t('admin.concepts.labels.pseudo') %>
      </div>
    </div>
  <% end %>
</div>

<script type="text/javascript">
  var changes = null;
  $(function(){

    changes = new FormChanges($('.concept-item'), '<%= admin_concept_path(id: '_OBJECT_ID_', course: @course, method: :patch).html_safe %>', 'patch');
    changes.on('change', function(t){
      $('#concept-buttons-changes').show();
      $('#concept-buttons-changes-count').html(t.getChangesCount());
    }).on('updateStarted', function(){
      NProgress.start();
      $('.concept-buttons').hide();
      $('.concept-loading').show();
      $('#concepts-list').fadeTo(250, 0.2);
    }).on('updateNext', function(t){
      NProgress.set(t.getQueueStatus());
    }).on('updateFinished', function(){
      NProgress.done();
      $('#concept-buttons-changes').hide();
      $('.concept-buttons').show();
      $('.concept-loading').hide();
      $('#concepts-list').fadeTo(250, 1.0);
    });

  });
</script>

<div id="concepts-learning-objects-template" style="display: none">
  <h2>&quot;{{=it.name}}&quot; - vzdelávacie objekty</h2>
  <div class="concept-learning-objects">
    {{~it.learning_objects :learning_object}}
    <div id="concept-learning-object{{=learning_object.id}}" class="learning-object"><a class="remove" href="#" onclick="concept_lo_delete('{{=learning_object.id}}');return false"><i class="fa fa-trash"></i></a><a target="_blank" href="/admin/learning_objects/{{=learning_object.lo_id}}/edit">{{=learning_object.name}}</a></div>
    {{~}}
  </div>

  <%= link_to("Zmeniť priradenie vzdelávacích objektov ku konceptom <i class=\"fa fa-external-link\" aria-hidden=\"true\"></i>".html_safe,
              question_concept_config_path(course_id: @course.id), class: 'concept-editor-link', target: '_blank') %>
</div>